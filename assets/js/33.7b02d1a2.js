(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{635:function(t,e,s){"use strict";s.r(e);var a=s(14),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("hr"),t._v(" "),s("h1",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("hook这一特性让functional组件更加强大，社区中有很多hooks库出现，hook注意的三要素如下")]),t._v(" "),s("ul",[s("li",[t._v("只能在functional组件中使用")]),t._v(" "),s("li",[t._v("不要在循环判断嵌套下使用hook")]),t._v(" "),s("li",[t._v("自定义hook use**开头")])]),t._v(" "),s("h1",{attrs:{id:"本文阅读最常用的usestate和比较复杂的useeffect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本文阅读最常用的usestate和比较复杂的useeffect"}},[t._v("#")]),t._v(" 本文阅读最常用的useState和比较复杂的useEffect")]),t._v(" "),s("h1",{attrs:{id:"usestate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usestate"}},[t._v("#")]),t._v(" useState")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/facebook/react/blob/v16.13.1/packages/react/src/ReactHooks.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码地址"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("export function useState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n    //看来重点在resolveDispatcher里\n  const dispatcher = resolveDispatcher();\n  return dispatcher.useState(initialState);\n}\nfunction resolveDispatcher() {\n    //看看ReactCurrentDispatcher \n  const dispatcher = ReactCurrentDispatcher.current;\n  invariant(\n    dispatcher !== null,\n    '......省略掉.',\n  );\n  return dispatcher;\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("p",[s("a",{attrs:{href:"https://github.com/facebook/react/blob/v16.13.1/packages/react/src/ReactCurrentDispatcher.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactCurrentDispatcher代码地址"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("发现整个代码反复套娃都跑到另一个包下面了。\n"),s("a",{attrs:{href:"https://github.com/facebook/react/blob/v16.13.1/packages/react-reconciler/src/ReactFiberHooks.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactFiberHooks代码地址"),s("OutboundLink")],1),t._v("这个包下面定义了类型，我没学过flow就当做typescript来看吧,搜索一下发现这个文件有一堆useState方法，当时我就傻了，之后发现他们在不同的对象内，看名字是实在不同生命周期，先看看HooksDispatcherOnMountInDEV里的吧")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("  useState<S>(\n      initialState: (() => S) | S,\n    ): [S, Dispatch<BasicStateAction<S>>] {\n      currentHookNameInDev = 'useState';\n      mountHookTypesDev();\n      const prevDispatcher = ReactCurrentDispatcher.current;\n      ReactCurrentDispatcher.current = InvalidNestedHooksDispatcherOnMountInDEV;\n      try {\n        return mountState(initialState);\n      } finally {\n        ReactCurrentDispatcher.current = prevDispatcher;\n      }\n    },\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);