(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{629:function(e,r,n){"use strict";n.r(r);var t=n(14),a=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("大家都熟悉Vue中依靠"),r("code",[e._v("Object.defineProperty()")]),e._v("来进行数据劫持,他像一个拦截器一样监控着一个对象上属性的改变。但是并不能深度监测到对象属性的变化，虽然Vue重写了一些array的原型链上的方法，如"),r("code",[e._v("push()")]),e._v("、"),r("code",[e._v("shift()")]),e._v("等，Vue官方也提供了方法"),r("code",[e._v("Vue.set( target, propertyName/index, value )")]),e._v("（target可以是数组也可以是对象）来解决这些问题，但是手动操作很不方便。")]),e._v(" "),r("p",[e._v("在Vue迎来3.0更新的时候，同样Vue将用"),r("code",[e._v("proxy")]),e._v("来实现数据劫持，接下来介绍介绍"),r("code",[e._v("proxy")]),e._v("有什么方便的地方吧。")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN的proxy文档"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("proxy")]),e._v("语法如下")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// const p = new Proxy(target, handler)\nconst handler = {\n    get: function(obj, prop) {\n        return prop in obj ? obj[prop] : 37;\n    }\n};\n\nconst p = new Proxy({}, handler);\np.a = 1;\np.b = undefined;\n\nconsole.log(p.a, p.b);      // 1, undefined\nconsole.log('c' in p, p.c); // false, 37\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br")])]),r("p",[e._v("很显然"),r("code",[e._v("proxy")]),e._v("相比"),r("code",[e._v("Object.defineProperty()")]),e._v("可以拦截属性的添加了，proxy不仅仅只有get，set拦截操作")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.getPrototypeOf()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.setPrototypeOf()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.isExtensible()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.preventExtensions()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.getOwnPropertyDescriptor()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.defineProperty()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.has()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.get()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.set()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.deleteProperty()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.ownKeys()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.apply()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("handler.construct()")]),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("这些都可以很多方法操作进行拦截")]),e._v(" "),r("p",[e._v("同样Vue3.0在实现数据劫持的时候还用到了Reflect属性")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN的Reflect文档"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("与大多数全局对象不同，"),r("code",[e._v("Reflect")]),e._v("不是一个构造函数。你不能将其与一个new运算符一起使用，或者将"),r("code",[e._v("Reflect")]),e._v("对象作为一个函数来调用。"),r("code",[e._v("Reflect")]),e._v("的所有属性和方法都是静态的（就像Math对象）。它可以修改一个对象的属性等。在这里不再赘述。")]),e._v(" "),r("p",[e._v("使用"),r("code",[e._v("proxy")]),e._v("实现双向绑定")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v(' <div id="app">\n      <input type="text" id="input" />\n      <div>您输入的是： <span id="title"></span></div>\n      <button type="button" name="button" id="btn">添加到todolist</button>\n      <ul id="list"></ul>\n </div>\n    const obj = {};\n    const input = document.getElementById("input");\n    const title = document.getElementById("title");\n    \n    const newObj = new Proxy(obj, {\n      get: function(target, key, receiver) {\n        console.log(`getting ${key}!`);\n        return Reflect.get(target, key, receiver);\n      },\n      set: function(target, key, value, receiver) {\n        console.log(target, key, value, receiver);\n        if (key === "text") {\n          input.value = value;\n          title.innerHTML = value;\n        }\n        return Reflect.set(target, key, value, receiver);\n      }\n    });\n\n    input.addEventListener("keyup", function(e) {\n      newObj.text = e.target.value;\n    });\n \n\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br"),r("span",{staticClass:"line-number"},[e._v("24")]),r("br"),r("span",{staticClass:"line-number"},[e._v("25")]),r("br"),r("span",{staticClass:"line-number"},[e._v("26")]),r("br"),r("span",{staticClass:"line-number"},[e._v("27")]),r("br"),r("span",{staticClass:"line-number"},[e._v("28")]),r("br"),r("span",{staticClass:"line-number"},[e._v("29")]),r("br"),r("span",{staticClass:"line-number"},[e._v("30")]),r("br")])])])}),[],!1,null,null,null);r.default=a.exports}}]);